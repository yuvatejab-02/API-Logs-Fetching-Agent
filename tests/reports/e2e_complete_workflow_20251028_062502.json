{
  "test_suite": "end_to_end_integration",
  "test_name": "complete_incident_log_workflow",
  "timestamp": "2025-10-28T06:25:02.632608+00:00",
  "status": "passed",
  "duration_seconds": null,
  "data_flow": {
    "01_incident_payload": {
      "incident_id": "INC_test_001",
      "service": "payments-service",
      "title": "Spike in 5xx errors for payments service",
      "full_payload": {
        "compslug": "companyname",
        "Session_id": "7b3f2f30-0c4b-4c42-9f8f-7e3d2b8e2a61",
        "incident_id": "INC_test_001",
        "title": "Spike in 5xx errors for payments service",
        "service": {
          "id": "al89asf9asdhjfaslkdjfl",
          "name": "payments-service"
        }
      }
    },
    "02_llm_query_generation": {
      "filter_expression": "service.name = 'payments-service' AND http.status_code >= 500 AND http.status_code < 600 AND severity_text = 'ERROR'",
      "reasoning": "Since the incident reports 5xx errors in the payments service, we filter for the exact service name, all 5xx status codes (500-599), and error severity to capture critical failures. This combination will show error logs directly related to the service outage.",
      "key_attributes": [
        "service.name",
        "http.status_code",
        "severity_text"
      ],
      "model": "anthropic.claude-3-5-sonnet-20241022-v2:0",
      "signoz_query": {
        "start": 1761629100665,
        "end": 1761632700665,
        "requestType": "raw",
        "variables": {},
        "compositeQuery": {
          "queries": [
            {
              "type": "builder_query",
              "spec": {
                "name": "A",
                "signal": "logs",
                "filter": {
                  "expression": "service.name = 'payments-service' AND http.status_code >= 500 AND http.status_code < 600 AND severity_text = 'ERROR'"
                },
                "order": [
                  {
                    "key": {
                      "name": "timestamp"
                    },
                    "direction": "desc"
                  },
                  {
                    "key": {
                      "name": "id"
                    },
                    "direction": "desc"
                  }
                ],
                "offset": 0,
                "limit": 1000
              }
            }
          ]
        }
      }
    },
    "03_signoz_fetch": {
      "endpoint": "https://selected-starling.us.signoz.cloud",
      "api_version": "v5",
      "raw_response_size_bytes": 282138,
      "fetch_successful": true
    },
    "04_log_transformation": {
      "logs_transformed": 230,
      "sample_log": {
        "timestamp": "2025-10-28T06:07:34.80007552Z",
        "service": "payments-service",
        "instance_id": "payments-service-e52e343e",
        "level": "ERROR",
        "request_id": "fc13d04099f103e52607775774635189",
        "company_id": "testing",
        "user_id": "user-8637",
        "method": "PUT",
        "path": "/api/v1/orders",
        "status_code": 503,
        "response_time_ms": 67,
        "message": "PUT /api/v1/orders - 503 (67ms)"
      },
      "transformed_logs_preview": [
        {
          "timestamp": "2025-10-28T06:07:34.80007552Z",
          "service": "payments-service",
          "instance_id": "payments-service-e52e343e",
          "level": "ERROR",
          "request_id": "fc13d04099f103e52607775774635189",
          "company_id": "testing",
          "user_id": "user-8637",
          "method": "PUT",
          "path": "/api/v1/orders",
          "status_code": 503,
          "response_time_ms": 67,
          "message": "PUT /api/v1/orders - 503 (67ms)"
        },
        {
          "timestamp": "2025-10-28T06:07:34.799764736Z",
          "service": "payments-service",
          "instance_id": "payments-service-e52e343e",
          "level": "ERROR",
          "request_id": "fc13d04099f103e52607775774635189",
          "company_id": "testing",
          "user_id": "user-8637",
          "method": "PUT",
          "path": "/api/v1/orders",
          "status_code": 503,
          "error_message": "Connection refused",
          "stack_trace": "at service.handler(handler.py:566)",
          "message": "Request failed: Connection refused"
        },
        {
          "timestamp": "2025-10-28T06:07:33.173719296Z",
          "service": "payments-service",
          "instance_id": "payments-service-e52e343e",
          "level": "ERROR",
          "request_id": "7cca8285b45ddeb11bdb29aa998d39bf",
          "company_id": "testing",
          "user_id": "user-5463",
          "method": "GET",
          "path": "/api/v1/users",
          "status_code": 500,
          "response_time_ms": 154,
          "message": "GET /api/v1/users - 500 (154ms)"
        },
        {
          "timestamp": "2025-10-28T06:07:33.1732224Z",
          "service": "payments-service",
          "instance_id": "payments-service-e52e343e",
          "level": "ERROR",
          "request_id": "7cca8285b45ddeb11bdb29aa998d39bf",
          "company_id": "testing",
          "user_id": "user-5463",
          "method": "GET",
          "path": "/api/v1/users",
          "status_code": 500,
          "error_message": "Resource not found",
          "stack_trace": "at service.handler(handler.py:495)",
          "message": "Request failed: Resource not found"
        },
        {
          "timestamp": "2025-10-28T06:07:31.678797824Z",
          "service": "payments-service",
          "instance_id": "payments-service-e52e343e",
          "level": "ERROR",
          "request_id": "79cbefa2e7d2292cf2682177277ae719",
          "company_id": "testing",
          "user_id": "user-2186",
          "method": "POST",
          "path": "/api/v1/orders",
          "status_code": 504,
          "response_time_ms": 118,
          "message": "POST /api/v1/orders - 504 (118ms)"
        }
      ]
    },
    "05_s3_storage": {
      "s3_bucket": "incident-logs-test",
      "s3_key": "incidents/INC_test_001/logs/20251028_062502.json",
      "s3_uri": "s3://incident-logs-test/incidents/INC_test_001/logs/20251028_062502.json",
      "storage_backend": "LocalStack",
      "upload_successful": true
    },
    "06_verification": {
      "download_successful": true,
      "data_integrity_verified": true,
      "logs_verified": 230,
      "files_in_incident": 2
    }
  },
  "summary": {
    "total_steps": 6,
    "steps_passed": 6,
    "steps_failed": 0,
    "logs_processed": 230,
    "storage_verified": true
  },
  "components": {
    "llm": {
      "service": "AWS Bedrock",
      "model": "Claude 3.5 Sonnet"
    },
    "observability": {
      "service": "SigNoz Cloud",
      "endpoint": "https://selected-starling.us.signoz.cloud"
    },
    "storage": {
      "service": "LocalStack",
      "bucket": "incident-logs-test"
    }
  }
}